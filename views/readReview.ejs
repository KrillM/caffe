<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('fragments/header') %>
    <title><%= review.title %></title>
</head>
<body>
    <%- include('fragments/navbar') %>

    <div class="jumbotron jumbotron-fluid crewForm">
        <div class="container">
            <% if(review.representImage !== null) { %>
                <img src="../files/<%= review.representImage %>" class="img-fluid" />
            <% } else { %>
                <img src="../static/virtualLake.png" class="img-fluid" />
            <% } %>
            <h1 class="display-4"><%= review.title %></h1>
            <p class="nav justify-content-end">
                <% if(review.updatedAt.getTime() !== review.createdAt.getTime()) { %>
                    <span>Updated At <%= review.updatedAt.toLocaleString() %></span>
                <% } else { %>
                    <span>Created At <%= review.createdAt.toLocaleString() %></span>
                <% } %>
            </p>
            <p class="nav justify-content-end">
                <span>Written by <%= review.crew.nickname %></span>
            </p>
            <div class="nav justify-content-end">
                <% if(isLoggedIn && crew && crew.crewId === review.writtenBy) { %>
                    <button type="button" class="btn btn-outline-warning btn-sm" onClick="goUpdateReview()">Edit</button>
                    <form name="form-patch" action="/write/update/<%= review.reviewId %>" method="post">
                        <input type="hidden" name="email" value="<%= crew.email %>">
                        <input type="hidden" name="reviewId" value="<%= review.reviewId %>">
                    </form>
                <% } else { %>
                <% } %> 
            </div>
            <hr/>
            <p class="lead"><%- review.content %></p>
            <div class="form-group">
                <label for="comment">Comment</label>
                <% if(isLoggedIn && crew) { %>
                    <input type="text" name="comment" class="form-control addtxt" /><br/> 
                    <button type="button" class="btn btn-outline-info btn-sm">Cancel</button>
                    <button type="button" class="btn btn-outline-success btn-sm">Comment</button>
                <%} else { %>
                    <input type="text" name="comment" placeholder="로그인 후 댓글 작성이 가능합니다." class="form-control addtxt" readonly/><br/> 
                <% } %>
            </div>

            <div class="container justify-content-center">
                <div class="d-flex">
                    <div class="second py-2 px-2"> 
                        <div class="d-flex justify-content-between py-1 pt-2">
                            <div>
                                <img src="https://i.imgur.com/tPvlEdq.jpg" width="30" height="30" class="d-inline-block align-text-top rounded-circle">
                                <span class="text2">Curtis</span>
                            </div>
                        </div>
                        <span class="text1">Type your note, and hit enter to add it</span>
                        <div>
                            <button type="button" class="btn btn-outline-info btn-sm">Cancel</button>
                            <button type="button" class="btn btn-outline-success btn-sm">Comment</button>
                        </div>
                    </div>
                </div>
                <div class="d-flex">
                    <div class="second py-2 px-2"> 
                        <div class="d-flex justify-content-between py-1 pt-2">
                            <div>
                                <img src="https://i.imgur.com/tPvlEdq.jpg" width="30" height="30" class="d-inline-block align-text-top rounded-circle">
                                <span class="text2">Curtis</span>
                            </div>
                        </div>
                        <span class="text1">Type your note, and hit enter to add it</span>
                    </div>
                </div>
                <div class="d-flex">
                    <div class="second py-2 px-2"> 
                        <div class="d-flex justify-content-between py-1 pt-2">
                            <div>
                                <img src="https://i.imgur.com/tPvlEdq.jpg" width="30" height="30" class="d-inline-block align-text-top rounded-circle">
                                <span class="text2">Curtis</span>
                            </div>
                        </div>
                        <span class="text1">Type your note, and hit enter to add it Type your note, and hit enter to add it Type your note, and hit enter to add it Type your note, and hit enter to add it Type your note, and hit enter to add it Type your note, and hit enter to add it Type your note, and hit enter to add it Type your note, and hit enter to add it</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <%- include('fragments/footer') %>
    <%- include('fragments/footerJs') %>
    <script>
        function goUpdateReview() {
            const form = document.forms["form-patch"];
            const email = form.email.value;
            const reviewId = form.reviewId.value;

            axios({
                method: 'get',
                url: `/write/update/<%= review.reviewId %>`,
                data: { email: email }
            }).then((res) => {
                const formInfo = document.forms["form-patch"];
                formInfo.email.value = res.data.email;
                formInfo.reviewId.value = res.data.reviewId;
                formInfo.submit();
            }).catch((err) => {
                alert("글 수정 페이지에 접근할 수 없습니다.");
            });
        }
    </script>
</body>
</html>