<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('fragments/header') %>
    <title><%= review.title %></title>
</head>
<body>
    <%- include('fragments/navbar') %>

    <div class="jumbotron jumbotron-fluid crewForm">
        <div class="container">
            <% if(review.representImage !== null) { %>
                <img src="../files/<%= review.representImage %>" class="img-fluid" />
            <% } else { %>
                <img src="../static/virtualLake.png" class="img-fluid" />
            <% } %>
            <h1 class="display-4"><%= review.title %></h1>
            <p class="nav justify-content-end">
                <% if(review.updatedAt.getTime() !== review.createdAt.getTime()) { %>
                    <span>Updated At <%= review.updatedAt.toLocaleString() %></span>
                <% } else { %>
                    <span>Created At at <%= review.createdAt.toLocaleString() %></span>
                <% } %>
            </p>
            <p class="nav justify-content-end">
                <span>Written by <%= review.crew.nickname %></span>
            </p>
            <div class="nav justify-content-end">
                <% if(isLoggedIn && crew && crew.crewId === review.writtenBy) { %>
                    <button type="button" class="btn btn-outline-warning" onClick="goUpdateReview()">Edit</button>
                    <form name="form-patch" action="/write/update/<%= review.reviewId %>" method="post">
                        <input type="hidden" name="email" value="<%= crew.email %>">
                        <input type="hidden" name="reviewId" value="<%= review.reviewId %>">
                    </form>
                <% } else { %>
                <% } %> 
            </div>
            <hr/>
            <p class="lead"><%- review.content %></p>
            <div class="form-group">
                <label for="comment">Comment</label>
                <% if(isLoggedIn && crew) { %>
                    <textarea class="form-control" name="comment" rows="2" id="comment"></textarea><br/>
                    <button type="button" class="btn btn-outline-info">Cancel</button>
                    <button type="button" class="btn btn-outline-success">Comment</button>
                <%} else { %>
                    <textarea class="form-control" name="comment" rows="2" readonly>로그인 후 댓글 작성이 가능합니다.</textarea><br/>
                <% } %>
            </div>
        </div>
    </div>

    <%- include('fragments/footer') %>
    <%- include('fragments/footerJs') %>
    <script>
        function goUpdateReview() {
            const form = document.forms["form-patch"];
            const email = form.email.value;
            const reviewId = form.reviewId.value;

            axios({
                method: 'get',
                url: `/write/update/<%= review.reviewId %>`,
                data: { email: email }
            }).then((res) => {
                const formInfo = document.forms["form-patch"];
                formInfo.email.value = res.data.email;
                formInfo.reviewId.value = res.data.reviewId;
                formInfo.submit();
            }).catch((err) => {
                alert("글 수정 페이지에 접근할 수 없습니다.");
            });
        }
    </script>
</body>
</html>